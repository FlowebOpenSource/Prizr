package fi.floweb
 
import fi.floweb.prizr.beans.*;

rule "Category, country and location code determine which pricemultiplier should be used"
	when 
		$preq : PricingRequest()
		$pres : PricingResponse(pricingDone == false)
		$multiplier : MultiplierBase(appliesToLocation == $preq.locationCode && 
									countryCode == $preq.countryCode &&
									appliesToCategory == $preq.itemCategoryCode)
	then
		System.out.println("Request on then: "+$preq);
		System.out.println("Multiplier on then: "+$multiplier);
		double newPrice = $preq.getSalesPrice()*$multiplier.getMultiplier();
		double transit = $preq.getItemStandardCost()+($multiplier.getIncludesFreight() / $preq.getItemUnitCC());
		transit = transit * $multiplier.getFreightMultiplier();
		double finalPrice = newPrice + transit; 
		$pres.setPrice(finalPrice);
		$pres.setPricingDone(true);
		System.out.println("Purchaseprice: "+$preq.getSalesPrice());
		System.out.println("Multiplied price: "+$pres.getPrice());
		update( $pres )
end